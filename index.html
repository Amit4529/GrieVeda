<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>GrieVeda â€” Login or Register</title>
    <meta name="description" content="GrieVeda: Centralized community grievance platform for Indian audiences. File complaints, track status, and view community feed." />
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      :root {
        --primary: #1e66f5;
        --accent: #f59e0b;
        --bg: #f5f7fb;
        --card: #ffffff;
        --text: #0f172a;
        --muted: #eef2ff;
        --muted-text: #64748b;
        --border: #e2e8f0;

        --radius: 12px;
        --shadow: 0 8px 24px rgba(2, 6, 23, 0.06);
        --shadow-sm: 0 2px 8px rgba(2, 6, 23, 0.06);
      }
      body {
        font-family: 'Inter', sans-serif;
        color: var(--text);
        background-color: var(--bg);
        line-height: 1.55;
      }
      h1, h2, h3 {
        font-family: 'Poppins', sans-serif;
      }
      a { color: inherit; text-decoration: none; }
      
      .btn-face {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }
      .toast {
        transition: all .25s ease-in-out;
      }
      .toast.show {
        opacity: 1;
        transform: translateY(0);
      }
    </style>
  </head>
  <body class="min-h-screen bg-neutral-50/50 text-slate-900">
    <!-- Header / Brand -->
    <header class="px-4 pt-8 pb-2 text-center">
      <div class="inline-flex items-center gap-3">
        <div
          aria-hidden="true"
          class="h-12 w-12 rounded-xl bg-[#0b3ea1] text-white font-extrabold grid place-items-center shadow"
        >
          G
        </div>
        <h1 class="text-3xl font-extrabold leading-none tracking-tight">
          <span class="text-blue-600">Grie</span>
          <span class="text-amber-500">Veda</span>
        </h1>
      </div>

      <p class="mx-auto mt-3 max-w-prose text-balance text-slate-600">
        Your Voice, Our Priority. Empowering Indian communities through centralized grievance management. Report
        issues, track progress, and build a better tomorrow together.
      </p>
      <div class="mt-2 flex items-center justify-center gap-4 text-sm text-slate-600">
        <span>ðŸ”’ Secure & Transparent</span>
        <span>ðŸ‘¥ Community Driven</span>
      </div>
    </header>

    <!-- Card -->
    <section class="mx-auto w-full max-w-[560px] rounded-2xl border border-slate-200 bg-white p-5 shadow-xl">
      <h2 id="welcome" class="font-bold text-lg">
        Welcome to GrieVeda
      </h2>
      <p class="mt-1 text-slate-600">Join thousands making a difference in their communities</p>

      <!-- Tabs -->
      <div
        class="mt-3 grid grid-cols-2 gap-1 rounded-xl border border-slate-200 bg-slate-100 p-1"
        role="tablist"
        aria-label="Authentication"
      >
        <button
          id="tab-login"
          role="tab"
          aria-selected="true"
          aria-controls="panel-login"
          class="h-10 rounded-lg border border-transparent font-semibold data-[active=true]:bg-white data-[active=true]:border-slate-200"
          data-active="true"
        >
          Login
        </button>
        <button
          id="tab-register"
          role="tab"
          aria-selected="false"
          aria-controls="panel-register"
          class="h-10 rounded-lg border border-transparent font-semibold"
          data-active="false"
        >
          Register
        </button>
      </div>

      <!-- Login Panel -->
      <div id="panel-login" role="tabpanel" tabindex="0" aria-labelledby="tab-login" class="mt-3">
        <form id="formLogin" novalidate>
          <div class="grid gap-3">
            <div class="grid gap-1">
              <label for="loginEmail" class="text-sm font-semibold">
                Email Address
              </label>
              <input
                id="loginEmail"
                type="email"
                placeholder="your.email@example.com"
                class="h-11 rounded-xl border border-slate-200 bg-slate-100 px-3 text-[15px] outline-none"
                autocomplete="email"
              />
            </div>

            <div class="grid gap-1">
              <label for="loginMobile" class="text-sm font-semibold">
                Mobile Number
              </label>
              <input
                id="loginMobile"
                type="tel"
                placeholder="+91 98765 43210"
                class="h-11 rounded-xl border border-slate-200 bg-slate-100 px-3 text-[15px] outline-none"
                autocomplete="tel"
              />
            </div>

            <button
              id="btnLogin"
              type="submit"
              class="h-11 rounded-xl bg-blue-600 font-bold text-white shadow"
            >
              Sign In
            </button>
          </div>
        </form>

        <div class="my-3 flex items-center gap-3 text-sm text-slate-600">
          <span class="h-px flex-1 bg-slate-200" />
          OR
          <span class="h-px flex-1 bg-slate-200" />
        </div>

        <button
          id="btnLoginFace"
          class="btn-face h-11 w-full rounded-xl border border-slate-200 bg-slate-100 font-semibold"
          aria-label="Login with Face Authentication"
        >
          ðŸ“· Face Authentication
        </button>

        <p class="mt-3 text-center text-sm text-slate-600">
          <a id="forgot" href="#">
            Forgot your details?
          </a>
        </p>
      </div>

      <!-- Register Panel -->
      <div id="panel-register" role="tabpanel" tabindex="0" aria-labelledby="tab-register" class="mt-3 hidden">
        <form id="formRegister" novalidate>
          <div class="grid gap-3">
            <div class="grid gap-1">
              <label for="fullName" class="text-sm font-semibold">
                Full Name
              </label>
              <input
                id="fullName"
                placeholder="Enter your full name"
                class="h-11 rounded-xl border border-slate-200 bg-slate-100 px-3 text-[15px] outline-none"
                autocomplete="name"
                required
              />
            </div>

            <div class="grid gap-1">
              <label for="regEmail" class="text-sm font-semibold">
                Email Address
              </label>
              <input
                id="regEmail"
                type="email"
                placeholder="your.email@example.com"
                class="h-11 rounded-xl border border-slate-200 bg-slate-100 px-3 text-[15px] outline-none"
                autocomplete="email"
                required
              />
            </div>

            <div class="grid gap-1">
              <label for="regMobile" class="text-sm font-semibold">
                Mobile Number
              </label>
              <input
                id="regMobile"
                type="tel"
                placeholder="+91 98765 43210"
                class="h-11 rounded-xl border border-slate-200 bg-slate-100 px-3 text-[15px] outline-none"
                autocomplete="tel-national"
                required
              />
            </div>

            <div class="flex flex-wrap items-center gap-2">
              <button
                type="button"
                id="btnFaceEnroll"
                class="h-10 rounded-lg border border-slate-200 bg-slate-100 px-3 font-semibold"
              >
                ðŸ“· Start Face Auth
              </button>
              <span id="faceEnrollStatus" class="text-sm text-slate-600" aria-live="polite"></span>
            </div>

            <button
              id="btnCompleteReg"
              type="submit"
              class="h-11 rounded-xl bg-blue-600 font-bold text-white shadow"
            >
              Complete Registration with Face Auth
            </button>

            <p class="text-center text-sm text-slate-600">
              By registering, you agree to our <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>
            </p>
          </div>
        </form>
      </div>
    </section>

    <footer class="mx-auto mt-8 mb-6 text-center text-xs text-slate-600">
      Â© <span id="year"></span> GrieVeda Â· Secure â€¢ Transparent â€¢ Community-Driven
    </footer>

    <!-- Face Auth Modal -->
    <div
      id="faceModal"
      class="fixed inset-0 z-50 hidden place-items-center bg-black/45 p-4"
      role="dialog"
      aria-modal="true"
      aria-labelledby="faceTitle"
    >
      <div class="w-full max-w-[520px] rounded-xl border border-slate-200 bg-white p-4 shadow-xl">
        <h3 id="faceTitle" class="text-lg font-bold">
          Face Authentication
        </h3>
        <p class="mt-1 text-sm text-slate-600">
          Center your face in the frame. This demo captures a selfie and stores it locally. Replace with your real
          face auth later.
        </p>

        <div class="mt-3 grid aspect-[4/3] place-items-center overflow-hidden rounded-xl bg-black">
          <video id="video" autoplay playsinline class="h-full w-full object-cover"></video>
          <canvas id="snapshot" class="sr-only"></canvas>
        </div>

        <div class="mt-3 flex flex-wrap items-center gap-2">
          <button
            id="btnUpload"
            class="h-10 rounded-lg border border-slate-200 bg-slate-100 px-3 font-semibold"
          >
            Upload Selfie (fallback)
          </button>
          <input id="fileInput" type="file" accept="image/*" class="sr-only" />
          <div class="grow"></div>
          <button
            id="btnCancel"
            class="h-10 rounded-lg border border-slate-200 bg-slate-100 px-3 font-semibold"
          >
            Cancel
          </button>
          <button id="btnCapture" class="h-10 rounded-lg bg-blue-600 px-3 font-bold text-white">
            Capture
          </button>
        </div>
      </div>
    </div>

    <!-- Toast -->
    <div
      id="toast"
      role="status"
      aria-live="polite"
      class="fixed bottom-4 right-4 rounded-lg bg-black px-3 py-2 text-sm text-white opacity-0 transition-all"
    ></div>

    <script>
      // The dashboard URL is a separate file
      const DASHBOARD_URL = "/dashboard.html";

      const $ = (s, r = document) => r.querySelector(s);

      const toast = (msg) => {
        const t = $("#toast");
        if (!t) return;
        t.textContent = msg;
        t.classList.add("show");
        t.style.opacity = "1";
        setTimeout(() => {
          t.classList.remove("show");
          t.style.opacity = "0";
        }, 1800);
      };

      const isValidEmail = (v) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v || "");
      const isValidINMobile = (v) => {
        const d = String(v || "").replace(/\D/g, "");
        const ten = d.length === 10 ? d : d.startsWith("91") && d.length === 12 ? d.slice(2) : "";
        return !!ten && /^[6-9]\d{9}$/.test(ten);
      };

      // Tabs
      function selectTab(which) {
        const isLogin = which === "login";
        const tabLogin = $("#tab-login");
        const tabRegister = $("#tab-register");
        const panelLogin = $("#panel-login");
        const panelRegister = $("#panel-register");

        if (!tabLogin || !tabRegister || !panelLogin || !panelRegister) return;

        tabLogin.setAttribute("aria-selected", String(isLogin));
        tabRegister.setAttribute("aria-selected", String(!isLogin));
        tabLogin.dataset.active = String(isLogin);
        tabRegister.dataset.active = String(!isLogin);
        panelLogin.classList.toggle("hidden", !isLogin);
        panelRegister.classList.toggle("hidden", isLogin);
      }

      // Face auth (demo)
      const faceState = {
        stream: null,
        done: false,
        imageDataUrl: null,
        purpose: "login", // or "register"
      };

      async function startCamera() {
        try {
          faceState.stream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: "user" },
            audio: false,
          });
          const v = $("#video");
          if (v) v.srcObject = faceState.stream;
        } catch (e) {
          console.warn(e);
          toast("Camera unavailable. Use Upload Selfie.");
        }
      }

      function stopCamera() {
        if (faceState.stream) {
          faceState.stream.getTracks().forEach((t) => t.stop());
          faceState.stream = null;
        }
        const v = $("#video");
        if (v) v.srcObject = null;
      }

      function openFaceModal(purpose) {
        faceState.purpose = purpose;
        $("#faceModal")?.classList.remove("hidden");
        startCamera();
      }

      function closeFaceModal() {
        $("#faceModal")?.classList.add("hidden");
        stopCamera();
      }

      function captureSnapshot() {
        const video = $("#video");
        const canvas = $("#snapshot");
        if (!video || !canvas) return;
        const w = video.videoWidth || 640;
        const h = video.videoHeight || 480;
        canvas.width = w;
        canvas.height = h;
        const ctx = canvas.getContext("2d");
        if (ctx) {
          ctx.drawImage(video, 0, 0, w, h);
          const data = canvas.toDataURL("image/jpeg", 0.85);
          faceState.imageDataUrl = data;
          faceState.done = true;
          sessionStorage.setItem("grieveda:face", data);
          toast("Face captured âœ“");
          closeFaceModal();
          updateFaceEnrollStatus();
        }
      }

      function updateFaceEnrollStatus() {
        const el = $("#faceEnrollStatus");
        if (el) el.textContent = faceState.done ? "Face Auth complete âœ“" : "";
      }

      // Forms
      function onRegisterSubmit(e) {
        e.preventDefault();
        const name = $("#fullName")?.value?.trim();
        const email = $("#regEmail")?.value?.trim();
        const mobile = $("#regMobile")?.value?.trim();

        if (!name) return toast("Enter your full name");
        if (!isValidEmail(email)) return toast("Enter a valid email");
        if (!isValidINMobile(mobile)) return toast("Enter a valid Indian mobile number");
        if (!faceState.done) return toast("Face Authentication is required for registration");

        const user = { name, email, mobile, face: sessionStorage.getItem("grieveda:face") };
        localStorage.setItem("grieveda:user", JSON.stringify(user));
        sessionStorage.setItem("grieveda:session", "true");

        toast("Registration successful");
        window.location.href = DASHBOARD_URL;
      }

      function onLoginSubmit(e) {
        e.preventDefault();
        const email = $("#loginEmail")?.value?.trim();
        const mobile = $("#loginMobile")?.value?.trim();

        const emailOk = email ? isValidEmail(email) : false;
        const mobileOk = mobile ? isValidINMobile(mobile) : false;

        if (!(emailOk || mobileOk || faceState.done)) {
          return toast("Login with a valid email, mobile number, or Face Authentication");
        }
        
        // This is a simplified demo. In a real app, you would verify against a database.
        const existing = localStorage.getItem("grieveda:user");
        if (existing) {
          const user = JSON.parse(existing);
          const userMatches = (emailOk && user.email === email) || (mobileOk && user.mobile === mobile);
          
          if (userMatches || faceState.done) {
            sessionStorage.setItem("grieveda:session", "true");
            toast("Login successful");
            window.location.href = DASHBOARD_URL;
          } else {
            toast("Login failed. Please check your credentials.");
          }
        } else {
            toast("No account found. Please register first.");
        }
      }

      // Bind events after DOM ready
      window.addEventListener("DOMContentLoaded", () => {
        // Year
        const year = $("#year");
        if (year) year.textContent = String(new Date().getFullYear());

        // Tabs
        $("#tab-login")?.addEventListener("click", () => selectTab("login"));
        $("#tab-register")?.addEventListener("click", () => selectTab("register"));

        // Forms
        $("#formRegister")?.addEventListener("submit", onRegisterSubmit);
        $("#formLogin")?.addEventListener("submit", onLoginSubmit);

        // Face auth
        $("#btnLoginFace")?.addEventListener("click", () => openFaceModal("login"));
        $("#btnFaceEnroll")?.addEventListener("click", () => openFaceModal("register"));
        $("#btnCapture")?.addEventListener("click", captureSnapshot);
        $("#btnCancel")?.addEventListener("click", closeFaceModal);
        $("#btnUpload")?.addEventListener("click", () => $("#fileInput")?.click());
        $("#fileInput")?.addEventListener("change", (e) => {
          const file = e.target.files && e.target.files[0];
          if (!file) return;
          const rd = new FileReader();
          rd.onload = () => {
            faceState.imageDataUrl = rd.result;
            faceState.done = true;
            sessionStorage.setItem("grieveda:face", rd.result);
            toast("Selfie uploaded âœ“");
            closeFaceModal();
            updateFaceEnrollStatus();
          };
          rd.readAsDataURL(file);
        });

        // Forgot
        $("#forgot")?.addEventListener("click", (e) => {
          e.preventDefault();
          toast("Use mobile, email, or Face Auth to access your account.");
        });

        // Safety: stop camera when leaving
        window.addEventListener("beforeunload", () => {
          try {
            stopCamera();
          } catch {}
        });
      });
    </script>
  </body>
</html>
