<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>GrieVeda — Community Grievance Dashboard</title>
    <meta name="description" content="GrieVeda: Centralized community grievance platform for Indian audiences. File complaints, track status, and view community feed." />
     Fonts (2 families total): Poppins (headings), Inter (body) 
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <style>
      :root {
        /* Color system (5 total) */
        --primary: #1e66f5;  /* blue */
        --accent:  #f59e0b;  /* amber */
        --bg:      #f5f7fb;  /* light gray */
        --card:    #ffffff;  /* white */
        --text:    #0f172a;  /* slate-900 */
        --muted:   #64748b;  /* helper gray for borders/text (derivative, not counted as a core) */

        --radius: 12px;
        --shadow: 0 8px 24px rgba(2, 6, 23, 0.06);
        --shadow-sm: 0 2px 8px rgba(2, 6, 23, 0.06);
        --maxw: 1200px;
      }

      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0;
        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--text);
        background: var(--bg);
        line-height: 1.55;
      }

      a { color: inherit; text-decoration: none; }

      /* Header */
      header {
        background: var(--card);
        border-bottom: 1px solid #e5e7eb;
        position: sticky; top: 0; z-index: 100;
      }
      .nav {
        max-width: var(--maxw);
        margin: 0 auto;
        padding: 12px 16px;
        display: flex;
        align-items: center;
        gap: 16px;
      }
      .brand {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        font-weight: 700;
        font-family: Poppins, Inter, sans-serif;
        letter-spacing: 0.2px;
      }
      .brand-badge {
        width: 36px; height: 36px; border-radius: 8px;
        display: grid; place-items: center; background: #0b3ea1; color: #fff;
        box-shadow: var(--shadow-sm);
        font-size: 18px; font-weight: 700;
      }
      .brand strong { color: var(--primary); }
      .brand span { color: var(--accent); }

      .nav-links {
        display: flex; align-items: center; gap: 8px;
        margin-left: 8px;
      }
      .nav-links a {
        padding: 8px 12px; border-radius: 8px; color: #334155; font-weight: 500;
      }
      .nav-links a.active, .nav-links a:hover { background: #eef2ff; color: #1e3a8a; }

      .nav-grow { flex: 1; }
      .nav-actions { display: flex; align-items: center; gap: 8px; }
      .input {
        height: 38px; background: #f1f5f9; border: 1px solid #e5e7eb; border-radius: 10px;
        padding: 0 12px; font-size: 14px; color: #0f172a; outline: none;
      }
      .icon-btn {
        width: 38px; height: 38px; border-radius: 10px; border: 1px solid #e5e7eb; background: #fff;
        display: grid; place-items: center; cursor: pointer;
      }
      .avatar {
        width: 38px; height: 38px; border-radius: 50%; background: #e2e8f0; display: grid; place-items: center; font-weight: 700;
      }

      /* Main layout */
      main { max-width: var(--maxw); margin: 24px auto; padding: 0 16px 64px; }
      .welcome {
        display: flex; flex-direction: column; gap: 6px; margin-bottom: 16px;
      }
      .welcome h1 {
        margin: 0; font-family: Poppins, Inter, sans-serif; font-weight: 700; letter-spacing: -0.3px;
        font-size: clamp(22px, 4vw, 28px);
      }
      .sub {
        color: #475569; max-width: 70ch;
      }

      /* KPIs */
      .kpis {
        display: grid;
        grid-template-columns: repeat(2, minmax(0,1fr));
        gap: 12px;
      }
      @media (min-width: 900px) {
        .kpis { grid-template-columns: repeat(4, 1fr); }
      }
      .kpi {
        background: var(--card); border: 1px solid #e5e7eb; border-radius: var(--radius); padding: 16px;
        display: grid; gap: 8px; box-shadow: var(--shadow-sm);
      }
      .kpi .label { color: #475569; font-size: 14px; display: flex; align-items: center; gap: 8px; }
      .kpi .value { font-size: 24px; font-weight: 700; letter-spacing: -0.3px; }
      .kpi .delta { font-size: 12px; color: #059669; }
      .kpi .delta.neg { color: #b45309; }

      /* Content grid */
      .content {
        margin-top: 20px;
        display: grid; gap: 16px;
        grid-template-columns: 1fr;
      }
      @media (min-width: 1000px) {
        .content { grid-template-columns: 1.4fr 1fr; }
      }

      /* Quick actions */
      .panel {
        background: var(--card); border: 1px solid #e5e7eb; border-radius: var(--radius); box-shadow: var(--shadow-sm);
      }
      .panel-header {
        padding: 16px; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; justify-content: space-between;
      }
      .panel-title {
        font-weight: 700; font-family: Poppins, Inter, sans-serif; letter-spacing: -0.2px;
      }
      .actions-grid {
        padding: 16px;
        display: grid; gap: 12px;
        grid-template-columns: repeat(1, minmax(0, 1fr));
      }
      @media (min-width: 700px) {
        .actions-grid { grid-template-columns: repeat(3, 1fr); }
      }
      .action-card {
        border: 1px solid #e5e7eb; border-radius: 14px; padding: 16px; background: #fff; display: grid; gap: 10px;
      }
      .action-top { display: flex; align-items: center; gap: 10px; }
      .pill {
        width: 36px; height: 36px; border-radius: 10px; display: grid; place-items: center;
        background: #eff6ff; color: #1d4ed8; border: 1px solid #dbeafe;
      }
      .action-card h3 { margin: 0; font-size: 16px; font-weight: 700; }
      .action-card p { margin: 0; color: #64748b; font-size: 14px; }
      .btn {
        appearance: none; border: none; cursor: pointer; height: 38px; padding: 0 14px; border-radius: 10px;
        font-weight: 600; color: #fff; background: var(--primary); box-shadow: var(--shadow-sm);
      }
      .btn.accent { background: var(--accent); color: #1f2937; }
      .btn.ghost { background: #f8fafc; color: #0f172a; border: 1px solid #e5e7eb; }
      .btn:focus-visible { outline: 2px solid #93c5fd; outline-offset: 2px; }

      /* Tabs under quick actions */
      .tabs {
        padding: 0 16px 16px;
        display: grid; gap: 12px;
      }
      .tab-list {
        background: #f8fafc; border: 1px solid #e5e7eb; border-radius: 12px; padding: 6px;
        display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px;
      }
      .tab-btn {
        height: 40px; border-radius: 10px; border: 1px solid transparent; background: transparent; cursor: pointer; font-weight: 600;
      }
      .tab-btn[aria-selected="true"] { background: #fff; border-color: #e5e7eb; }
      .tab-panel { display: none; }
      .tab-panel.active { display: block; }
      .form {
        margin-top: 8px; background: #fff; border: 1px solid #e5e7eb; border-radius: 14px; padding: 16px; box-shadow: var(--shadow-sm);
        display: grid; gap: 12px;
      }
      label { font-weight: 600; font-size: 14px; }
      .field { display: grid; gap: 6px; }
      .input, select, textarea {
        background: #f8fafc; border: 1px solid #e5e7eb; border-radius: 10px; padding: 10px 12px; font-size: 14px; color: #0f172a;
      }
      textarea { min-height: 100px; resize: vertical; }

      /* Recent activity */
      .list {
        padding: 12px 12px 16px;
        display: grid; gap: 12px;
      }
      .item {
        background: #fff; border: 1px solid #e5e7eb; border-radius: 14px; padding: 12px; display: grid; gap: 8px; box-shadow: var(--shadow-sm);
      }
      .item-top {
        display: flex; align-items: center; justify-content: space-between; gap: 8px; color: #475569; font-size: 12px;
      }
      .chip {
        font-size: 11px; padding: 4px 8px; border-radius: 999px; border: 1px solid #e5e7eb; background: #f8fafc; color: #334155; font-weight: 600;
      }
      .chip.status.in-progress { background: #eff6ff; color: #1d4ed8; border-color: #dbeafe; }
      .chip.status.resolved { background: #ecfdf5; color: #059669; border-color: #bbf7d0; }
      .chip.status.pending { background: #fff7ed; color: #b45309; border-color: #fed7aa; }
      .chip.pri.low { background: #ecfeff; color: #0e7490; border-color: #a5f3fc; }
      .chip.pri.medium { background: #fefce8; color: #a16207; border-color: #fde68a; }
      .chip.pri.high { background: #fef2f2; color: #b91c1c; border-color: #fecaca; }

      .item h4 { margin: 0; font-size: 16px; font-weight: 700; }
      .item-meta {
        display: flex; flex-wrap: wrap; gap: 12px; color: #64748b; font-size: 13px;
      }

      /* Helpers */
      .sr-only { position: absolute; width: 1px; height: 1px; margin: -1px; padding: 0; overflow: hidden; clip: rect(0 0 0 0); border: 0; }
      .row { display: grid; gap: 12px; }
      @media (min-width: 680px) {
        .row.two { grid-template-columns: 1fr 1fr; }
      }
      .toast {
        position: fixed; right: 16px; bottom: 16px; background: #111827; color: #fff; padding: 12px 14px; border-radius: 10px; box-shadow: var(--shadow);
        opacity: 0; transform: translateY(6px); transition: all .25s ease;
      }
      .toast.show { opacity: 1; transform: translateY(0); }
      footer { margin-top: 32px; color: #64748b; font-size: 12px; text-align: center; }
    </style>
  </head>
  <body>
    <header role="banner" aria-label="Top navigation">
      <div class="nav">
        <a href="#" class="brand" aria-label="GrieVeda Home">
          <div class="brand-badge" aria-hidden="true">G</div>
          <div>
            <span style="font-size: 18px;"><strong>Grie</strong><span>Veda</span></span>
          </div>
        </a>

        <nav class="nav-links" aria-label="Primary">
          <a href="#" class="active">Dashboard</a>
          <a href="#" id="nav-my-complaints">My Complaints</a>
          <a href="#" id="nav-community">Community</a>
          <a href="#" id="nav-help">Help</a>
        </nav>

        <div class="nav-grow"></div>

        <div class="nav-actions">
          <input class="input" type="search" placeholder="Search complaints..." id="globalSearch" aria-label="Search complaints" />
          <button class="icon-btn" title="Notifications" aria-label="Notifications">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M15 18H6l1-1v-5a5 5 0 1 1 10 0v5l1 1h-3Z" stroke="#334155" stroke-width="1.5" stroke-linecap="round"/>
              <path d="M10 18a2 2 0 0 0 4 0" stroke="#334155" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
          </button>
          <div class="avatar" aria-label="Profile">IN</div>
        </div>
      </div>
    </header>

    <main role="main">
      <section class="welcome" aria-labelledby="welcome-title">
        <h1 id="welcome-title">Welcome to GrieVeda</h1>
        <p class="sub">Your voice matters. Report issues, track progress, and build a better community together.</p>
      </section>

      <section class="kpis" aria-label="Key statistics">
        <div class="kpi">
          <div class="label">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M4 12h4l3-8 4 16 3-8h3" stroke="#1e3a8a" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Total Complaints
          </div>
          <div class="value" id="kpi-total">1,247</div>
          <div class="delta">+12% from last month</div>
        </div>
        <div class="kpi">
          <div class="label">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <circle cx="12" cy="12" r="9" stroke="#a16207" stroke-width="1.7"/>
              <path d="M12 7v6l3 3" stroke="#a16207" stroke-width="1.7" stroke-linecap="round"/>
            </svg>
            Pending Review
          </div>
          <div class="value" id="kpi-pending">43</div>
          <div class="delta neg">-5% from last month</div>
        </div>
        <div class="kpi">
          <div class="label">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="m4 12 5 5L20 6" stroke="#059669" stroke-width="1.7" stroke-linecap="round"/>
            </svg>
            Resolved
          </div>
          <div class="value" id="kpi-resolved">892</div>
          <div class="delta">+18% from last month</div>
        </div>
        <div class="kpi">
          <div class="label">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M7 20v-7H4l8-9 8 9h-3v7H7Z" stroke="#be5a1a" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Active Users
          </div>
          <div class="value" id="kpi-users">3,421</div>
          <div class="delta">+7% from last month</div>
        </div>
      </section>

      <section class="content">
         Left: Quick Actions + Tabs 
        <section class="panel" aria-label="Quick actions">
          <div class="panel-header">
            <div class="panel-title">Quick Actions</div>
            <button class="btn ghost" id="btnSetLocation">Set Location</button>
          </div>

          <div class="actions-grid" role="list">
            <article class="action-card" role="listitem">
              <div class="action-top">
                <div class="pill" aria-hidden="true">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M12 5v14M5 12h14" stroke="#1d4ed8" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                </div>
                <h3>File New Complaint</h3>
              </div>
              <p>Report an issue in your community</p>
              <button class="btn" data-open-tab="file">Get Started</button>
            </article>

            <article class="action-card" role="listitem">
              <div class="action-top">
                <div class="pill" aria-hidden="true">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <circle cx="11" cy="11" r="7" stroke="#1d4ed8" stroke-width="2"/>
                    <path d="m20 20-3-3" stroke="#1d4ed8" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                </div>
                <h3>Track Status</h3>
              </div>
              <p>Check your complaint progress</p>
              <button class="btn" data-open-tab="track">Get Started</button>
            </article>

            <article class="action-card" role="listitem">
              <div class="action-top">
                <div class="pill" aria-hidden="true">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M4 5h16M4 12h16M4 19h10" stroke="#1d4ed8" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                </div>
                <h3>Community Feed</h3>
              </div>
              <p>See issues near you</p>
              <button class="btn accent" data-open-tab="feed">Get Started</button>
            </article>
          </div>

          <div class="tabs" aria-label="Complaint tools">
            <div class="tab-list" role="tablist" aria-label="Select tool">
              <button class="tab-btn" id="tab-file" role="tab" aria-selected="true" aria-controls="panel-file">File Complaint</button>
              <button class="tab-btn" id="tab-track" role="tab" aria-selected="false" aria-controls="panel-track">Track Status</button>
              <button class="tab-btn" id="tab-feed" role="tab" aria-selected="false" aria-controls="panel-feed">Community Feed</button>
            </div>

             File Complaint 
            <div id="panel-file" class="tab-panel active" role="tabpanel" tabindex="0" aria-labelledby="tab-file">
              <form class="form" id="formNew">
                <div class="row two">
                  <div class="field">
                    <label for="title">Issue Title</label>
                    <input id="title" class="input" required placeholder="e.g., Street Light Not Working" />
                  </div>
                  <div class="field">
                    <label for="category">Category</label>
                    <select id="category" required>
                      <option value="">Select category</option>
                      <option>Sanitation</option>
                      <option>Roads & Traffic</option>
                      <option>Water Supply</option>
                      <option>Electricity</option>
                      <option>Public Safety</option>
                      <option>Other</option>
                    </select>
                  </div>
                </div>

                <div class="row two">
                  <div class="field">
                    <label for="city">City</label>
                    <select id="city" required>
                      <option value="">Select city</option>
                      <option>Bengaluru</option>
                      <option>Gurugram</option>
                      <option>New Delhi</option>
                      <option>Mumbai</option>
                      <option>Pune</option>
                      <option>Chennai</option>
                      <option>Hyderabad</option>
                    </select>
                  </div>
                  <div class="field">
                    <label for="area">Area / Locality</label>
                    <input id="area" class="input" required placeholder="e.g., MG Road" />
                  </div>
                </div>

                <div class="field">
                  <label for="desc">Description</label>
                  <textarea id="desc" placeholder="Describe the issue and any details that can help"></textarea>
                </div>

                <div class="row two">
                  <div class="field">
                    <label for="priority">Priority</label>
                    <select id="priority" required>
                      <option>Low</option>
                      <option>Medium</option>
                      <option>High</option>
                    </select>
                  </div>
                  <div class="field">
                    <label for="photo">Photo (optional)</label>
                    <input id="photo" type="file" class="input" accept="image/*" />
                  </div>
                </div>

                <div style="display:flex; gap:8px; align-items:center;">
                  <button class="btn" type="submit">Submit Complaint</button>
                  <button class="btn ghost" type="reset">Clear</button>
                </div>
              </form>
            </div>

             Track Status 
            <div id="panel-track" class="tab-panel" role="tabpanel" tabindex="0" aria-labelledby="tab-track">
              <form class="form" id="formTrack">
                <div class="row two">
                  <div class="field">
                    <label for="trackId">Complaint ID</label>
                    <input id="trackId" class="input" placeholder="e.g., GRV-2024-001" />
                  </div>
                  <div class="field">
                    <label for="trackPhone">Registered Mobile (optional)</label>
                    <input id="trackPhone" class="input" placeholder="+91 98765 43210" />
                  </div>
                </div>
                <button class="btn" type="submit">Check Status</button>
                <div id="trackResult" style="margin-top:10px;"></div>
              </form>
            </div>

             Community Feed 
            <div id="panel-feed" class="tab-panel" role="tabpanel" tabindex="0" aria-labelledby="tab-feed">
              <div class="form" role="region" aria-label="Feed filters">
                <div class="row two">
                  <div class="field">
                    <label for="filterCity">City</label>
                    <select id="filterCity">
                      <option value="__auto__">Near Me (set location)</option>
                      <option>Bengaluru</option>
                      <option>Gurugram</option>
                      <option>New Delhi</option>
                      <option>Mumbai</option>
                      <option>Pune</option>
                      <option>Chennai</option>
                      <option>Hyderabad</option>
                    </select>
                  </div>
                  <div class="field">
                    <label for="filterPriority">Priority</label>
                    <select id="filterPriority">
                      <option value="">All</option>
                      <option>Low</option>
                      <option>Medium</option>
                      <option>High</option>
                    </select>
                  </div>
                </div>
                <div style="display:flex; gap:8px;">
                  <input class="input" id="filterText" placeholder="Search in feed..." />
                  <button class="btn ghost" id="btnClearFilters" type="button">Clear</button>
                </div>
              </div>

              <div id="feedList" class="list" aria-live="polite" aria-busy="false"></div>
            </div>
          </div>
        </section>

         Right: Recent Activity 
        <section class="panel" aria-label="Recent activity">
          <div class="panel-header">
            <div class="panel-title">Recent Activity</div>
            <div class="btn ghost" id="btnRefresh">Refresh</div>
          </div>
          <div id="recentList" class="list" aria-live="polite" aria-busy="false"></div>
        </section>
      </section>

      <footer>© <span id="year"></span> GrieVeda · Secure • Transparent • Community-Driven</footer>
    </main>

    <div class="toast" id="toast" role="status" aria-live="polite"></div>

    <script>
      // Simple in-memory + localStorage store
      const LS_KEY = "grieveda:complaints";
      const state = {
        myCity: localStorage.getItem("grieveda:city") || "",
        complaints: [],
      };

      // Demo seed data
      const seed = [
        {
          id: "GRV-2024-001",
          status: "Under Review",
          priority: "Medium",
          title: "Street Light Not Working",
          city: "Bengaluru",
          area: "MG Road",
          by: "Rajesh Kumar",
          createdAt: Date.now() - 2 * 60 * 60 * 1000, // 2h
        },
        {
          id: "GRV-2024-002",
          status: "Resolved",
          priority: "High",
          title: "Water Logging Issue",
          city: "Gurugram",
          area: "Sector 14",
          by: "Priya Sharma",
          createdAt: Date.now() - 5 * 60 * 60 * 1000, // 5h
        },
        {
          id: "GRV-2024-003",
          status: "In Progress",
          priority: "Low",
          title: "Garbage Collection Delay",
          city: "Bengaluru",
          area: "Koramangala",
          by: "Amit Patel",
          createdAt: Date.now() - 24 * 60 * 60 * 1000, // 1d
        },
        {
          id: "GRV-2024-004",
          status: "Pending",
          priority: "High",
          title: "Pothole on Main Road",
          city: "New Delhi",
          area: "CP",
          by: "Sunita Singh",
          createdAt: Date.now() - 2 * 24 * 60 * 60 * 1000, // 2d
        },
      ];

      // Utilities
      const $ = (sel, root = document) => root.querySelector(sel);
      const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));
      const fmtId = () => "GRV-" + new Date().getFullYear() + "-" + String(Math.floor(Math.random() * 999) + 100).padStart(3, "0");
      const relTime = (ts) => {
        const s = Math.floor((Date.now() - ts) / 1000);
        if (s < 60) return s + " sec ago";
        const m = Math.floor(s / 60);
        if (m < 60) return m + " min ago";
        const h = Math.floor(m / 60);
        if (h < 24) return h + " hours ago";
        const d = Math.floor(h / 24);
        return d + " days ago";
      };
      const toast = (msg) => {
        const el = $("#toast");
        el.textContent = msg;
        el.classList.add("show");
        setTimeout(() => el.classList.remove("show"), 2000);
      };

      // Load / Save
      function loadState() {
        try {
          const raw = localStorage.getItem(LS_KEY);
          state.complaints = raw ? JSON.parse(raw) : seed;
        } catch {
          state.complaints = seed;
        }
      }
      function saveState() {
        localStorage.setItem(LS_KEY, JSON.stringify(state.complaints));
      }

      // Rendering
      function statusChipClass(status) {
        const s = status.toLowerCase();
        if (s.includes("resolved")) return "resolved";
        if (s.includes("progress")) return "in-progress";
        if (s.includes("pending")) return "pending";
        if (s.includes("review")) return "pending";
        return "";
      }

      function renderRecent() {
        const list = $("#recentList");
        list.innerHTML = "";

        // Sort by most recent
        const items = [...state.complaints].sort((a, b) => b.createdAt - a.createdAt).slice(0, 8);

        items.forEach(c => {
          const div = document.createElement("article");
          div.className = "item";
          div.innerHTML = `
            <div class="item-top">
              <div style="display:flex; align-items:center; gap:8px;">
                <span class="chip">${c.id}</span>
                <span class="chip pri ${c.priority.toLowerCase()}">${c.priority}</span>
                <span class="chip status ${statusChipClass(c.status)}">${c.status}</span>
              </div>
              <div>${relTime(c.createdAt)}</div>
            </div>
            <h4>${c.title}</h4>
            <div class="item-meta">
              <div>📍 ${c.area}, ${c.city}</div>
              <div>👤 ${c.by}</div>
            </div>
          `;
          list.appendChild(div);
        });
      }

      function renderFeed() {
        const list = $("#feedList");
        const citySel = $("#filterCity");
        const priSel = $("#filterPriority");
        const q = $("#filterText").value.trim().toLowerCase();
        list.setAttribute("aria-busy", "true");
        list.innerHTML = "";

        let city = citySel.value;
        if (city === "__auto__") city = state.myCity || "";

        let items = [...state.complaints];

        if (city) items = items.filter(c => c.city.toLowerCase() === city.toLowerCase());
        if (priSel.value) items = items.filter(c => c.priority === priSel.value);
        if (q) items = items.filter(c =>
          c.title.toLowerCase().includes(q) ||
          c.area.toLowerCase().includes(q) ||
          c.id.toLowerCase().includes(q)
        );

        if (items.length === 0) {
          const empty = document.createElement("div");
          empty.className = "item";
          empty.innerHTML = `<p>No complaints match your filters. Try changing the city or clearing filters.</p>`;
          list.appendChild(empty);
        } else {
          items.sort((a, b) => b.createdAt - a.createdAt).forEach(c => {
            const div = document.createElement("article");
            div.className = "item";
            div.innerHTML = `
              <div class="item-top">
                <div style="display:flex; align-items:center; gap:8px;">
                  <span class="chip">${c.id}</span>
                  <span class="chip pri ${c.priority.toLowerCase()}">${c.priority}</span>
                  <span class="chip status ${statusChipClass(c.status)}">${c.status}</span>
                </div>
                <div>${relTime(c.createdAt)}</div>
              </div>
              <h4>${c.title}</h4>
              <div class="item-meta">
                <div>📍 ${c.area}, ${c.city}</div>
                <div>👤 ${c.by}</div>
              </div>
            `;
            list.appendChild(div);
          });
        }

        list.setAttribute("aria-busy", "false");
      }

      function updateKPIs() {
        const total = state.complaints.length;
        const pending = state.complaints.filter(c => /pending|review/i.test(c.status)).length;
        const resolved = state.complaints.filter(c => /resolved/i.test(c.status)).length;

        $("#kpi-total").textContent = total.toLocaleString("en-IN");
        $("#kpi-pending").textContent = pending.toLocaleString("en-IN");
        $("#kpi-resolved").textContent = resolved.toLocaleString("en-IN");
        // Users stays demo-static
      }

      // Tabs
      function selectTab(key) {
        const map = { file: ["#tab-file", "#panel-file"], track: ["#tab-track", "#panel-track"], feed: ["#tab-feed", "#panel-feed"] };
        Object.values(map).forEach(([t, p]) => {
          $(t).setAttribute("aria-selected", "false");
          $(p).classList.remove("active");
        });
        const [tabSel, panelSel] = map[key];
        $(tabSel).setAttribute("aria-selected", "true");
        $(panelSel).classList.add("active");
      }

      // Events
      function bindEvents() {
        // Quick action buttons open tabs
        $$("[data-open-tab]").forEach(btn => {
          btn.addEventListener("click", () => selectTab(btn.getAttribute("data-open-tab")));
        });

        // Tab buttons
        $("#tab-file").addEventListener("click", () => selectTab("file"));
        $("#tab-track").addEventListener("click", () => selectTab("track"));
        $("#tab-feed").addEventListener("click", () => { selectTab("feed"); renderFeed(); });

        // New complaint
        $("#formNew").addEventListener("submit", (e) => {
          e.preventDefault();
          const title = $("#title").value.trim();
          const category = $("#category").value;
          const city = $("#city").value;
          const area = $("#area").value.trim();
          const desc = $("#desc").value.trim();
          const priority = $("#priority").value;
          if (!title || !category || !city || !area) return toast("Please fill all required fields.");

          const id = fmtId();
          const entry = {
            id,
            status: "Pending",
            priority,
            title,
            city,
            area,
            by: "You",
            createdAt: Date.now(),
            desc
          };
          state.complaints.push(entry);
          saveState();
          updateKPIs();
          renderRecent();
          if ($("#panel-feed").classList.contains("active")) renderFeed();

          e.target.reset();
          toast("Complaint submitted: " + id);
          selectTab("track");
          $("#trackId").value = id;
        });

        // Track
        $("#formTrack").addEventListener("submit", (e) => {
          e.preventDefault();
          const id = $("#trackId").value.trim();
          const phone = $("#trackPhone").value.trim();
          const res = state.complaints.find(c => c.id.toLowerCase() === id.toLowerCase());
          const box = $("#trackResult");
          if (!id) {
            box.innerHTML = `<div class="item"><p>Please enter your Complaint ID.</p></div>`;
            return;
          }
          if (!res) {
            box.innerHTML = `<div class="item"><p>No record found for <strong>${id}</strong>. Check the ID and try again.</p></div>`;
            return;
          }
          const steps = {
            "Pending": ["Received", "Assigned to Department", "Pending Review"],
            "Under Review": ["Received", "Assigned to Department", "Under Review"],
            "In Progress": ["Received", "Assigned to Department", "In Progress"],
            "Resolved": ["Received", "Assigned to Department", "Resolved"],
          }[res.status] || ["Received"];
          box.innerHTML = `
            <article class="item">
              <div class="item-top">
                <div style="display:flex; gap:8px; align-items:center;">
                  <span class="chip">${res.id}</span>
                  <span class="chip pri ${res.priority.toLowerCase()}">${res.priority}</span>
                  <span class="chip status ${statusChipClass(res.status)}">${res.status}</span>
                </div>
                <div>${relTime(res.createdAt)}</div>
              </div>
              <h4>${res.title}</h4>
              <div class="item-meta">
                <div>📍 ${res.area}, ${res.city}</div>
                <div>👤 ${res.by}</div>
              </div>
              <div style="margin-top:8px;">
                <strong>Progress:</strong>
                <ul style="margin:6px 0 0 16px;">
                  ${steps.map(s => `<li>${s}</li>`).join("")}
                </ul>
              </div>
            </article>
          `;
        });

        // Feed filters
        $("#filterCity").addEventListener("change", renderFeed);
        $("#filterPriority").addEventListener("change", renderFeed);
        $("#filterText").addEventListener("input", renderFeed);
        $("#btnClearFilters").addEventListener("click", () => {
          $("#filterCity").value = "__auto__";
          $("#filterPriority").value = "";
          $("#filterText").value = "";
          renderFeed();
        });

        // Global Search (filters recent activity quickly)
        $("#globalSearch").addEventListener("input", (e) => {
          const q = e.target.value.trim().toLowerCase();
          const list = $("#recentList");
          list.querySelectorAll(".item").forEach(card => {
            const keep = card.textContent.toLowerCase().includes(q);
            card.style.display = keep ? "" : "none";
          });
        });

        // Set location (simple city prompt for demo)
        $("#btnSetLocation").addEventListener("click", async () => {
          const city = prompt("Set your city (e.g., Bengaluru, Mumbai, New Delhi):", state.myCity || "Bengaluru");
          if (city) {
            state.myCity = city.trim();
            localStorage.setItem("grieveda:city", state.myCity);
            toast("Location set to " + state.myCity);
            // Auto-filter feed if on feed tab
            if ($("#panel-feed").classList.contains("active")) {
              $("#filterCity").value = "__auto__";
              renderFeed();
            }
          }
        });

        // Refresh demo button
        $("#btnRefresh").addEventListener("click", () => {
          renderRecent();
          toast("Refreshed");
        });
      }

      // Init
      (function init() {
        $("#year").textContent = new Date().getFullYear();
        loadState();
        updateKPIs();
        renderRecent();
        bindEvents();

        // First-load feed render if feed tab active
        // Keep default on "File" tab; feed renders on demand
      })();
    </script>
  </body>
</html>